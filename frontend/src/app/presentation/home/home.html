<div class="home-wrapper">
  <header class="top-bar">
    <h1 class="app-title">âš” Tableau des Raids</h1>
    <div class="top-bar-actions">
      <button class="btn-profil" routerLink="/profil">â­ Ma Wishlist</button>
      <span class="user-tag">{{ currentUser?.email }}</span>
      <button class="btn-logout" (click)="logout()">DÃ©connexion</button>
    </div>
  </header>

  @if (successMessage) {
    <div class="alert alert-success">{{ successMessage }}</div>
  }
  @if (errorMessage) {
    <div class="alert alert-error">{{ errorMessage }}</div>
  }

  <div class="actions-bar">
    <p class="raid-count">
      <span class="count-dot"></span>
      {{ raids.length }} raid(s) disponible(s)
    </p>
    <button class="btn-create" (click)="toggleCreateForm()">
      {{ showCreateForm ? 'âœ• Annuler' : '+ CrÃ©er un Raid' }}
    </button>
  </div>

  @if (showCreateForm) {
    <div class="create-form">
      <div class="create-form-header">
        <span class="form-icon">ğŸ°</span>
        <span class="form-label">Forger un nouveau raid</span>
      </div>
      <div class="create-form-inner">
        <input
          type="text"
          [(ngModel)]="newRaidName"
          placeholder="Nom du raid..."
          (keyup.enter)="createRaid()"
        />
        <button
          class="btn-confirm-create"
          [disabled]="!newRaidName.trim() || isCreating"
          (click)="createRaid()"
        >
          {{ isCreating ? 'CrÃ©ation...' : 'âš” Forger' }}
        </button>
      </div>
    </div>
  }

  @if (raids.length > 0) {
    <div class="raids-grid">
      @for (raid of raids; track raid.id) {
        <div
          class="raid-card"
          [class.joined]="isUserInRaid(raid)"
          [class.admin]="isRaidAdmin(raid)"
        >
          <div class="card-top-line"></div>

          <div class="raid-card-header">
            <h3 class="raid-name">{{ raid.name }}</h3>
            <div class="raid-badges">
              @if (isRaidAdmin(raid)) {
                <span class="badge badge-admin">ğŸ‘‘ Admin</span>
              }
              @if (isUserInRaid(raid) && !isRaidAdmin(raid)) {
                <span class="badge badge-joined">â— Rejoint</span>
              }
            </div>
          </div>

          <div class="raid-members">
            <span class="members-icon">ğŸ‘¥</span>
            <span class="members-count">{{ raid.users?.length || 0 }} membre(s)</span>
            <span class="raid-creator"
              >â€” crÃ©Ã© par {{ raid.createdBy?.name || raid.createdBy?.email }}</span
            >
          </div>

          @if (raid.users && raid.users.length > 0) {
            <div class="members-list">
              @for (user of raid.users; track user.id) {
                <span class="member-tag">{{ user.name || user.email }}</span>
              }
            </div>
          } @else {
            <p class="no-members">Aucun membre</p>
          }

          <div class="raid-card-actions">
            <button class="btn-details" routerLink="/boss">ğŸ“‹ Boss</button>

            @if (isUserInRaid(raid)) {
              <button class="btn-dkp" [routerLink]="['/dkp', raid.id]">ğŸ“Š DKP</button>
            }

            @if (isRaidAdmin(raid)) {
              <button class="btn-admin" [routerLink]="['/raid-admin', raid.id]">ğŸ‘‘ GÃ©rer</button>
            }

            @if (isUserInRaid(raid) && !isRaidAdmin(raid)) {
              <button class="btn-leave" (click)="leaveRaid()">âœ• Quitter</button>
            }

            @if (!isUserInRaid(raid)) {
              <button
                class="btn-join"
                [disabled]="isUserInAnyRaid() || isJoining === raid.id"
                (click)="requestJoin(raid.id)"
              >
                @if (isJoining === raid.id) {
                  Envoi...
                } @else if (isUserInAnyRaid()) {
                  DÃ©jÃ  dans un raid
                } @else {
                  ğŸ›¡ Demander Ã  rejoindre
                }
              </button>
            }
          </div>
        </div>
      }
    </div>
  } @else {
    <div class="empty-state">
      <p class="empty-icon">ğŸ°</p>
      <p class="empty-text">Aucun raid disponible</p>
      <p class="empty-sub">Soyez le premier Ã  en crÃ©er un !</p>
    </div>
  }
</div>
