<div class="boss-detail-wrapper">
  <header class="top-bar">
    <button class="btn-back" routerLink="/boss">‚Üê Retour aux boss</button>
    @if (boss) {
      <h1 class="page-title">‚öî {{ boss.name }}</h1>
    }
  </header>

  @if (sucessMessage) {
    <div class="alert alert-success">{{ sucessMessage }}</div>
  }
  @if (errorMessage) {
    <div class="alert alert-error">{{ errorMessage }}</div>
  }

  @if (boss) {
    <div class="loots-section">
      <p class="loots-count">
        <span class="loots-icon">üéÅ</span>
        {{ boss.loots?.length || 0 }} loot(s) disponible(s)
      </p>

      @if (boss.loots && boss.loots.length > 0) {
        <div class="loots-grid">
          @for (loot of boss.loots; track loot.id) {
            <div class="loot-card">
              <a [href]="loot.url" target="_blank" class="loot-link">{{ loot.name }}</a>

            
              @if (getTopCandidate(loot.id); as top) {
                <div class="loot-top-candidate">
                  <span class="crown">üëë</span>
                  <span class="top-name">{{ top.name }}</span>
                  <span class="top-info">({{ top.classe?.name }} ¬∑ {{ top.points }} pts)</span>
                </div>
              }

             
              @if (getCandidates(loot.id).length > 0) {
                <button class="btn-candidates" (click)="toggleCandidates(loot.id)">
                  {{ getCandidates(loot.id).length }} joueur(s) int√©ress√©(s)
                  {{ expandedLootId === loot.id ? '‚ñ≤' : '‚ñº' }}
                </button>
              } @else {
                <span class="no-candidates">Aucun joueur int√©ress√©</span>
              }

             
              @if (expandedLootId === loot.id) {
                <div class="candidates-list">
                  @for (candidate of getCandidates(loot.id); track candidate.userId; let i = $index) {
                    <div class="candidate-row" [class.is-top]="i === 0">
                      <span class="candidate-rank">
                        @if (i === 0) { üëë } @else if (i === 1) { ü•à } @else if (i === 2) { ü•â } @else { #{{ i + 1 }} }
                      </span>
                      <span class="candidate-name">{{ candidate.name }}</span>
                      <span class="candidate-class">{{ candidate.classe?.name }}</span>
                      <span class="candidate-spec">{{ candidate.specialisation?.name }}</span>
                      <span class="candidate-points">{{ candidate.points }} pts</span>
                    </div>
                  }
                </div>
              }

              <button
                class="btn-wishlist"
                [disabled]="addingLootId === loot.id"
                (click)="addLoot(loot.id)"
              >
                @if (addingLootId === loot.id) {
                  Ajout...
                } @else {
                  ‚≠ê Ajouter √† ma wishlist
                }
              </button>
            </div>
          }
        </div>
      } @else {
        <div class="empty-state">
          <p>Aucun loot pour ce boss</p>
        </div>
      }
    </div>
  }
</div>